syntax = "proto3";
package layer.dispute;

import "cosmos/base/query/v1beta1/pagination.proto";
import "gogoproto/gogo.proto";
import "google/api/annotations.proto";
import "layer/dispute/dispute.proto";
import "layer/dispute/open_disputes.proto";
import "layer/dispute/params.proto";
import "layer/dispute/tally.proto";
import "layer/dispute/vote.proto";

option go_package = "github.com/tellor-io/layer/x/dispute/types";

// Query defines the gRPC querier service.
service Query {
  // Parameters queries the parameters of the module.
  rpc Params(QueryParamsRequest) returns (QueryParamsResponse) {
    option (google.api.http).get = "/tellor-io/layer/dispute/params";
  }
  // Disputes queries all disputes.
  rpc Disputes(QueryDisputesRequest) returns (QueryDisputesResponse) {
    option (google.api.http).get = "/tellor-io/layer/dispute/disputes";
  }
  // Dispute queries a specific dispute by id.
  rpc Dispute(QueryDisputeRequest) returns (QueryDisputeResponse) {
    option (google.api.http).get = "/tellor-io/layer/dispute/dispute/{dispute_id}";
  }
  // OpenDisputes queries all the open disputes.
  rpc OpenDisputes(QueryOpenDisputesRequest) returns (QueryOpenDisputesResponse) {
    option (google.api.http).get = "/tellor-io/layer/dispute/open-disputes";
  }
  // team vote queries the team vote for a dispute.
  rpc TeamVote(QueryTeamVoteRequest) returns (QueryTeamVoteResponse) {
    option (google.api.http).get = "/tellor-io/layer/dispute/team-vote/{dispute_id}";
  }
  // team address queries the team address.
  rpc TeamAddress(QueryTeamAddressRequest) returns (QueryTeamAddressResponse) {
    option (google.api.http).get = "/tellor-io/layer/dispute/team-address";
  }
  // Tally queries the vote count of a dispute
  rpc Tally(QueryDisputesTallyRequest) returns (QueryDisputesTallyResponse) {
    option (google.api.http).get = "/tellor-io/layer/dispute/tally/{dispute_id}";
  }
  
  // VoteResult queries the vote result of a dispute
  rpc VoteResult(QueryDisputeVoteResultRequest) returns (QueryDisputeVoteResultResponse) {
    option (google.api.http).get = "/tellor-io/layer/dispute/vote-result/{dispute_id}";
  }

  // DisputeFeePayers queries all fee payers for a dispute
  rpc DisputeFeePayers(QueryDisputeFeePayersRequest) returns (QueryDisputeFeePayersResponse) {
    option (google.api.http).get = "/tellor-io/layer/dispute/dispute-fee-payers/{dispute_id}";
  }

  // ClaimableDisputeRewards queries the amount of loya that can be claimed for a specific dispute
  rpc ClaimableDisputeRewards(QueryClaimableDisputeRewardsRequest) returns (QueryClaimableDisputeRewardsResponse) {
    option (google.api.http).get = "/tellor-io/layer/dispute/claimable-dispute-rewards/{dispute_id}/{address}";
  }
}

// QueryParamsRequest is request type for the Query/Params RPC method.
message QueryParamsRequest {}

// QueryParamsResponse is response type for the Query/Params RPC method.
message QueryParamsResponse {
  // params holds all the parameters of this module.
  Params params = 1 [(gogoproto.nullable) = false];
}

message QueryDisputesRequest {
  // pagination defines an optional pagination for the request.
  cosmos.base.query.v1beta1.PageRequest pagination = 1;
}

message Disputes {
  uint64 disputeId = 1;
  Dispute metadata = 2;
}

message QueryDisputesResponse {
  // pagination defines an optional pagination for the request.
  cosmos.base.query.v1beta1.PageResponse pagination = 1;
  repeated Disputes disputes = 2;
}

// QueryDisputeRequest is the request type for the Query/Dispute RPC method.
message QueryDisputeRequest {
  // dispute_id defines the dispute id to query for.
  uint64 dispute_id = 1;
}

// QueryDisputeResponse is the response type for the Query/Dispute RPC method.
message QueryDisputeResponse {
  // dispute is the dispute details.
  Disputes dispute = 1;
}

message QueryOpenDisputesRequest {}

message QueryOpenDisputesResponse {
  OpenDisputes openDisputes = 1;
}

// QueryTeamVoteRequest is request type for the Query/TeamVote RPC method.
message QueryTeamVoteRequest {
  // disputeId defines the dispute id.
  uint64 dispute_id = 1;
}

// QueryTeamVoteResponse is response type for the Query/TeamVote RPC method.
message QueryTeamVoteResponse {
  // teamVote holds the team voter info for a dispute.
  Voter team_vote = 1 [(gogoproto.nullable) = false];
}

// QueryTeamAddressRequest is request type for the Query/TeamAddress RPC method.
message QueryTeamAddressRequest {}

// QueryTeamAddressResponse is response type for the Query/TeamAddress RPC method.
message QueryTeamAddressResponse {
  // teamAddress holds the team address.
  string team_address = 1;
}

// Request the current vote count for a dispute
message QueryDisputesTallyRequest {
  uint64 dispute_id = 1;
}

message QueryDisputesTallyResponse {
  GroupTally users = 1;
  GroupTally reporters = 2;
  FormattedVoteCounts team = 3;
  CombinedTotal combinedTotal = 4;
}

message QueryDisputeVoteResultRequest {
  uint64 dispute_id = 1;
}

message QueryDisputeVoteResultResponse {
  VoteResult vote_result = 1;
}

message QueryDisputeFeePayersRequest {
  uint64 dispute_id = 1;
}

message DisputeFeePayerInfo {
  string payer_address = 1;
  PayerInfo payer_info = 2 [(gogoproto.nullable) = false];
}

message QueryDisputeFeePayersResponse {
  repeated DisputeFeePayerInfo payers = 1;
}

message QueryClaimableDisputeRewardsRequest {
  uint64 dispute_id = 1;
  string address = 2;
}

message ClaimableAmount {
  uint64 dispute_id = 1;
  string reward_amount = 2 [(gogoproto.customtype) = "cosmossdk.io/math.Int", (gogoproto.nullable) = false];
  string fee_refund_amount = 3 [(gogoproto.customtype) = "cosmossdk.io/math.Int", (gogoproto.nullable) = false];
  bool reward_claimed = 4;
}

message QueryClaimableDisputeRewardsResponse {
  ClaimableAmount claimable_amount = 1;
}
